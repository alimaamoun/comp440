<!DOCTYPE html>
<html>
<head>
    <title>Sorted Information</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        .header {
            text-align: center;
            width: 100%;
            margin: 5px;
        }
        .header h1 {
            margin: 0;
        }
        .header form {
            display: inline;
        }
        .container {
            display: flex;
            width: 80%;
            justify-content: space-between;
        }
        .column {
            display: flex;
            flex-direction: column;
            width: 48%;
        }
        .form-box {
            border: 2px solid blue;
            text-align: center;
            margin: 10px;
            padding: 20px;
        }
        label {
            display: block;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        input[type="text"], input[type="number"] {
            width: 90%;
            padding: 5px;
            margin-bottom: 10px;
        }
        input[type="submit"] {
            margin-top: 10px;
            padding: 5px 10px;
        }
        h2 {
            text-decoration: underline;
        }
        .footer {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Sorted Information</h1>
        <form method="post" action="/logout">
            <input type="submit" name="logout" value="Logout">
        </form>
    </div>

    <div class="container">
        <div class="column">
            <div class="form-box">
                <h2>Most Expensive Items by Category</h2>
                <form id="mostExpensiveForm">
                    <input type="submit" value="Get Most Expensive Items">
                </form>
                <div id="mostExpensiveResults"></div>
            </div>

            <div class="form-box">
                <h2>Users with Most Items on 7/4/2024</h2>
                <form id="mostItemsForm">
                    <input type="submit" value="Get Users">
                </form>
                <div id="mostItemsResults"></div>
            </div>

            <div class="form-box">
                <h2>Poor Reviewers</h2>
                <form id="allPoorReviewsForm">
                    <input type="submit" value="Get Users">
                </form>
                <div id="poorReviewersResults"></div>
            </div>

            <div class="form-box">
                <h2>Never Poor Reviewers</h2>
                <form id="noPoorReviewsForm">
                    <input type="submit" value="Get Users">
                </form>
                <div id="nopoorReviewersResults"></div>
            </div>
            <div class="form-box">
                <h2>Users with Bad Items</h2>
                <form id="noExcellentItemsForm">
                    <input type="submit" value="Get Users">
                </form>
            </div>
            <div class="form-box">
                <h2>Users with Good Items</h2>
                <form id="noPoorItemsForm">
                    <input type="submit" value="Get Users">
                </form>
                <div id="nopoorItemsResults"></div>
            </div>
        </div>
        <div class="column">
            <div class="form-box">
                <h2>Users with Items in Two Categories on Same Day</h2>
                <form id="twoCategoriesForm">
                    <label for="category1">Category X:</label>
                    <input type="text" id="category1" name="category1" required>
                    <label for="category2">Category Y:</label>
                    <input type="text" id="category2" name="category2" required>
                    <input type="submit" value="Search Users">
                </form>
            </div>

            <div class="form-box">
                <h2>Items with Excellent or Good Comments</h2>
                <form id="excellentGoodForm">
                    <label for="user">User X:</label>
                    <input type="text" id="user" name="user" required>
                    <input type="submit" value="Search Items">
                </form>
            </div>
            <div class="form-box">
                <h2>Favorites</h2>
                <form id="favoritesForm" method="POST" action="/getFavorites">
                    <label for="userX">User X:</label>
                    <select id="userX" name="userX" required>
                    </select>
            
                    <label for="userY">User Y:</label>
                    <select id="userY" name="userY" required>
                    </select>
            
                    <input type="submit" value="Get Favorites" class="submit-button">
                </form>
            </div>
            
            
        </div>
    </div>

    <script>
        //#1
        document.getElementById('mostExpensiveForm').addEventListener('submit', function(event) {
    event.preventDefault();

        fetch('/getMostExpensiveItems', {
            method: 'POST',
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json(); // Try to parse as JSON only if response is OK
        })
        .then(data => {
            let resultsDiv = document.getElementById('mostExpensiveResults');
            resultsDiv.innerHTML = '';
            data.forEach(item => {
                resultsDiv.innerHTML += `<p>Category: ${item.category}, Title: ${item.title}, Price: ${item.price}</p>`;
            });
        })
        .catch(error => {
            console.error('Error fetching most expensive items:', error);
            let resultsDiv = document.getElementById('mostExpensiveResults');
            resultsDiv.innerHTML = '<p>Failed to load data. Please try again later.</p>';
        });
    });

    //#4
    document.getElementById('mostItemsForm').addEventListener('submit', function(event) {
    event.preventDefault();

        fetch('/most-items-on-7-4-2024', {
            method: 'POST', // Changed to POST
            headers: {
                'Content-Type': 'application/json' // Set headers if needed
            },
            body: JSON.stringify({}) // Empty body or add data if needed
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json(); // Parse JSON if response is OK
        })
        .then(data => {
            let resultsDiv = document.getElementById('mostItemsResults');
            resultsDiv.innerHTML = '';

            // Check if data is an array
            if (Array.isArray(data)) {
                data.forEach(user => {
                    // Assuming the server returns an array of objects with a 'username' field
                    resultsDiv.innerHTML += `<p>User: ${user.username}</p>`;
                });
            } else {
                resultsDiv.innerHTML = '<p>No data format found. Please try again later.</p>';
            }
        })
        .catch(error => {
            console.error('Error fetching users with most items on 7/4/2024:', error);
            let resultsDiv = document.getElementById('mostItemsResults');
            resultsDiv.innerHTML = '<p>Failed to load data. Please try again later.</p>';
        });
    });

    //#5
    document.getElementById('allPoorReviewsForm').addEventListener('submit', function(event) {
    event.preventDefault();

        fetch('/poor-reviewers', {
            method: 'GET',
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json(); // Parse JSON if response is OK
        })
        .then(data => {
            let resultsDiv = document.getElementById('poorReviewersResults');
            resultsDiv.innerHTML = '';

            // Check if data is an array
            if (Array.isArray(data)) {
                data.forEach(user => {
                    // Adjust if the field name in the response is different
                    resultsDiv.innerHTML += `<p>User: ${user.user_name}</p>`;
                });
            } else {
                resultsDiv.innerHTML = '<p>No data format found. Please try again later.</p>';
            }
        })
        .catch(error => {
            console.error('Error fetching poor reviewers:', error);
            let resultsDiv = document.getElementById('poorReviewersResults');
            resultsDiv.innerHTML = '<p>Failed to load data. Please try again later.</p>';
        });
    });

    // #2 new
    document.getElementById('noPoorReviewsForm').addEventListener('submit', function(event) {
    event.preventDefault();

    fetch('/never-poor-reviewers') // Ensure the correct endpoint is used
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json(); // Parse JSON if response is OK
        })
        .then(data => {
            console.log('Data received:', data); // Check the structure of the data
            let resultsDiv = document.getElementById('nopoorReviewersResults');
            resultsDiv.innerHTML = '';

            // Ensure data is an array and has the correct structure
            if (Array.isArray(data)) {
                data.forEach(user => {
                    console.log('User object:', user); // Debug each user object
                    if (user.username) { // Check if user_name exists
                        resultsDiv.innerHTML += `<p>User: ${user.username}</p>`;
                    } else {
                        resultsDiv.innerHTML += '<p>Unexpected data format: username missing.</p>';
                    }
                });
            } else {
                resultsDiv.innerHTML = '<p>Data is not an array. Please try again later.</p>';
            }
        })
        .catch(error => {
            console.error('Error fetching never-poor reviewers:', error);
            let resultsDiv = document.getElementById('nopoorReviewersResults');
            resultsDiv.innerHTML = '<p>Failed to load data. Please try again later.</p>';
        });
});


    //#6
    document.getElementById('noPoorItemsForm').addEventListener('submit', function(event) {
    event.preventDefault();

        fetch('/users-with-good-items', { // Ensure the correct endpoint is used
            method: 'GET',
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json(); // Parse JSON if response is OK
        })
        .then(data => {
            let resultsDiv = document.getElementById('nopoorItemsResults');
            resultsDiv.innerHTML = '';

            // Check if data is an array
            if (Array.isArray(data)) {
                data.forEach(user => {
                    resultsDiv.innerHTML += `<p>User: ${user.username}</p>`;
                });
            } else {
                resultsDiv.innerHTML = '<p>No data format found. Please try again later.</p>';
            }
        })
        .catch(error => {
            console.error('Error fetching users-with-good-items:', error);
            let resultsDiv = document.getElementById('nopoorItemsResults');
            resultsDiv.innerHTML = '<p>Failed to load data. Please try again later.</p>';
        });
    });


        
    </script>
    <div class="footer">
        <a href="/review">Go Back to Review Page</a>
    </div>
</body>
</html>

